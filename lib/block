#!/bin/bash

# Colors are already sourced by main script, no need to import again
# Block utility - run commands with colored output
block() {

    local color_func="info"
    local quiet=false
    local die_on_fail=false

    case "$1" in
        --info) color_func="info"; shift ;;
        --warn) color_func="warn"; shift ;;
        --gitop) color_func="gitop"; shift ;;
        --quiet) quiet=true; shift ;;
        --die) color_func="warn"; die_on_fail=true; shift ;;
    esac

    # Show command being executed (unless quiet)
    if [[ "$quiet" != "true" ]]; then
        $color_func "$* ..."
    fi

    # Execute command and return exit code
    eval "$*"
    local exit_code=$?

    # Show result (unless quiet)
    if [[ "$quiet" != "true" ]]; then
        if [[ $exit_code -eq 0 ]]; then
            $color_func "Done"
        else
            warn "Failed"
        fi
    fi

    # Exit if die_on_fail is set and command failed
    if [[ "$die_on_fail" == "true" && $exit_code -ne 0 ]]; then
        die "Command failed - exiting"
    fi

    return $exit_code
}